{"version":3,"file":"CandyMachine.mjs","sources":["../../../../../src/plugins/candyMachineModule/models/CandyMachine.ts"],"sourcesContent":["import { PublicKey } from '@solana/web3.js';\nimport {\n  CandyMachineData,\n  EndSettingType,\n  WhitelistMintMode,\n} from '@metaplex-foundation/mpl-candy-machine';\nimport {\n  Amount,\n  BigNumber,\n  DateTime,\n  lamports,\n  toBigNumber,\n  toDateTime,\n  toOptionDateTime,\n  UnparsedAccount,\n} from '@/types';\nimport { assert, Option, removeEmptyChars } from '@/utils';\nimport {\n  countCandyMachineItems,\n  getCandyMachineUuidFromAddress,\n  parseCandyMachineItems,\n} from '../helpers';\nimport {\n  CandyMachineAccount,\n  MaybeCandyMachineCollectionAccount,\n} from '../accounts';\nimport { Creator } from '@/types';\nimport { CandyMachineProgram } from '../program';\n\n// -----------------\n// Model\n// -----------------\n\n/** @group Models */\nexport type CandyMachine = {\n  readonly model: 'candyMachine';\n  readonly address: PublicKey;\n  readonly programAddress: PublicKey;\n  readonly version: 1 | 2;\n  readonly authorityAddress: PublicKey;\n  readonly walletAddress: PublicKey; // SOL treasury OR token account for the tokenMintAddress.\n  readonly tokenMintAddress: Option<PublicKey>;\n  readonly collectionMintAddress: Option<PublicKey>;\n  readonly uuid: string;\n  readonly price: Amount;\n  readonly symbol: string;\n  readonly sellerFeeBasisPoints: number;\n  readonly isMutable: boolean;\n  readonly retainAuthority: boolean;\n  readonly goLiveDate: Option<DateTime>;\n  readonly maxEditionSupply: BigNumber;\n  readonly items: CandyMachineItem[];\n  readonly itemsAvailable: BigNumber;\n  readonly itemsMinted: BigNumber;\n  readonly itemsRemaining: BigNumber;\n  readonly itemsLoaded: BigNumber;\n  readonly isFullyLoaded: boolean;\n  readonly endSettings: Option<CandyMachineEndSettings>;\n  readonly hiddenSettings: Option<CandyMachineHiddenSettings>;\n  readonly whitelistMintSettings: Option<CandyMachineWhitelistMintSettings>;\n  readonly gatekeeper: Option<CandyMachineGatekeeper>;\n  readonly creators: Creator[];\n};\n\n/** @group Models */\nexport type CandyMachineItem = {\n  readonly name: string;\n  readonly uri: string;\n};\n\n/** @group Models */\nexport type CandyMachineEndSettings =\n  | {\n      readonly endSettingType: EndSettingType.Amount;\n      readonly number: BigNumber;\n    }\n  | {\n      readonly endSettingType: EndSettingType.Date;\n      readonly date: DateTime;\n    };\n\n/** @group Models */\nexport type CandyMachineHiddenSettings = {\n  readonly name: string;\n  readonly uri: string;\n  readonly hash: number[];\n};\n\n/** @group Models */\nexport type CandyMachineWhitelistMintSettings = {\n  readonly mode: WhitelistMintMode;\n  readonly mint: PublicKey;\n  readonly presale: boolean;\n  readonly discountPrice: Option<Amount>;\n};\n\n/** @group Models */\nexport type CandyMachineGatekeeper = {\n  readonly network: PublicKey;\n  readonly expireOnUse: boolean;\n};\n\n// -----------------\n// Program to Model\n// -----------------\n\n/** @group Model Helpers */\nexport const isCandyMachine = (value: any): value is CandyMachine =>\n  typeof value === 'object' && value.model === 'candyMachine';\n\n/** @group Model Helpers */\nexport function assertCandyMachine(value: any): asserts value is CandyMachine {\n  assert(isCandyMachine(value), 'Expected CandyMachine type');\n}\n\n/** @group Model Helpers */\nexport const toCandyMachine = (\n  account: CandyMachineAccount,\n  unparsedAccount: UnparsedAccount,\n  collectionAccount: MaybeCandyMachineCollectionAccount | null\n): CandyMachine => {\n  const itemsAvailable = toBigNumber(account.data.data.itemsAvailable);\n  const itemsMinted = toBigNumber(account.data.itemsRedeemed);\n\n  const endSettings = account.data.data.endSettings;\n  const hiddenSettings = account.data.data.hiddenSettings;\n  const whitelistMintSettings = account.data.data.whitelistMintSettings;\n  const gatekeeper = account.data.data.gatekeeper;\n\n  const rawData = unparsedAccount.data;\n  const itemsLoaded = hiddenSettings\n    ? toBigNumber(0)\n    : countCandyMachineItems(rawData);\n  const items = hiddenSettings ? [] : parseCandyMachineItems(rawData);\n\n  return {\n    model: 'candyMachine',\n    address: account.publicKey,\n    programAddress: account.owner,\n    version: account.owner.equals(CandyMachineProgram.publicKey) ? 2 : 1,\n    authorityAddress: account.data.authority,\n    walletAddress: account.data.wallet,\n    tokenMintAddress: account.data.tokenMint,\n    collectionMintAddress:\n      collectionAccount && collectionAccount.exists\n        ? collectionAccount.data.mint\n        : null,\n    uuid: account.data.data.uuid,\n    price: lamports(account.data.data.price),\n    symbol: removeEmptyChars(account.data.data.symbol),\n    sellerFeeBasisPoints: account.data.data.sellerFeeBasisPoints,\n    isMutable: account.data.data.isMutable,\n    retainAuthority: account.data.data.retainAuthority,\n    goLiveDate: toOptionDateTime(account.data.data.goLiveDate),\n    maxEditionSupply: toBigNumber(account.data.data.maxSupply),\n    items,\n    itemsAvailable,\n    itemsMinted,\n    itemsRemaining: toBigNumber(itemsAvailable.sub(itemsMinted)),\n    itemsLoaded,\n    isFullyLoaded: itemsAvailable.lte(itemsLoaded),\n    endSettings: endSettings\n      ? endSettings.endSettingType === EndSettingType.Date\n        ? {\n            endSettingType: EndSettingType.Date,\n            date: toDateTime(endSettings.number),\n          }\n        : {\n            endSettingType: EndSettingType.Amount,\n            number: toBigNumber(endSettings.number),\n          }\n      : null,\n    hiddenSettings,\n    whitelistMintSettings: whitelistMintSettings\n      ? {\n          ...whitelistMintSettings,\n          discountPrice: whitelistMintSettings.discountPrice\n            ? lamports(whitelistMintSettings.discountPrice)\n            : null,\n        }\n      : null,\n    gatekeeper: gatekeeper\n      ? {\n          ...gatekeeper,\n          network: gatekeeper.gatekeeperNetwork,\n        }\n      : null,\n    creators: account.data.data.creators,\n  };\n};\n\n// -----------------\n// Model to Configs\n// -----------------\n\n/** @group Models */\nexport type CandyMachineConfigs = {\n  wallet: PublicKey;\n  tokenMint: Option<PublicKey>;\n  price: Amount;\n  sellerFeeBasisPoints: number;\n  itemsAvailable: BigNumber;\n  symbol: string;\n  maxEditionSupply: BigNumber;\n  isMutable: boolean;\n  retainAuthority: boolean;\n  goLiveDate: Option<DateTime>;\n  endSettings: Option<CandyMachineEndSettings>;\n  hiddenSettings: Option<CandyMachineHiddenSettings>;\n  whitelistMintSettings: Option<CandyMachineWhitelistMintSettings>;\n  gatekeeper: Option<CandyMachineGatekeeper>;\n  creators: Creator[];\n};\n\n/** @group Model Helpers */\nexport const toCandyMachineConfigs = (\n  candyMachine: CandyMachine\n): CandyMachineConfigs => {\n  return {\n    wallet: candyMachine.walletAddress,\n    tokenMint: candyMachine.tokenMintAddress,\n    ...candyMachine,\n  };\n};\n\n// -----------------\n// Configs to Program\n// -----------------\n\n/** @group Models */\nexport type CandyMachineInstructionData = {\n  wallet: PublicKey;\n  tokenMint: Option<PublicKey>;\n  data: CandyMachineData;\n};\n\n/** @group Model Helpers */\nexport const toCandyMachineInstructionData = (\n  address: PublicKey,\n  configs: CandyMachineConfigs\n): CandyMachineInstructionData => {\n  const endSettings = configs.endSettings;\n  const whitelistMintSettings = configs.whitelistMintSettings;\n  const gatekeeper = configs.gatekeeper;\n\n  return {\n    wallet: configs.wallet,\n    tokenMint: configs.tokenMint,\n    data: {\n      ...configs,\n      uuid: getCandyMachineUuidFromAddress(address),\n      price: configs.price.basisPoints,\n      maxSupply: configs.maxEditionSupply,\n      endSettings: endSettings\n        ? {\n            ...endSettings,\n            number:\n              endSettings.endSettingType === EndSettingType.Date\n                ? endSettings.date\n                : endSettings.number,\n          }\n        : null,\n      whitelistMintSettings: whitelistMintSettings\n        ? {\n            ...whitelistMintSettings,\n            discountPrice:\n              whitelistMintSettings.discountPrice?.basisPoints ?? null,\n          }\n        : null,\n      gatekeeper: gatekeeper\n        ? {\n            ...gatekeeper,\n            gatekeeperNetwork: gatekeeper.network,\n          }\n        : null,\n    },\n  };\n};\n"],"names":["isCandyMachine","value","model","assertCandyMachine","assert","toCandyMachine","account","unparsedAccount","collectionAccount","itemsAvailable","toBigNumber","data","itemsMinted","itemsRedeemed","endSettings","hiddenSettings","whitelistMintSettings","gatekeeper","rawData","itemsLoaded","countCandyMachineItems","items","parseCandyMachineItems","address","publicKey","programAddress","owner","version","equals","CandyMachineProgram","authorityAddress","authority","walletAddress","wallet","tokenMintAddress","tokenMint","collectionMintAddress","exists","mint","uuid","price","lamports","symbol","removeEmptyChars","sellerFeeBasisPoints","isMutable","retainAuthority","goLiveDate","toOptionDateTime","maxEditionSupply","maxSupply","itemsRemaining","sub","isFullyLoaded","lte","endSettingType","EndSettingType","Date","date","toDateTime","number","Amount","discountPrice","network","gatekeeperNetwork","creators","toCandyMachineConfigs","candyMachine","toCandyMachineInstructionData","configs","getCandyMachineUuidFromAddress","basisPoints"],"mappings":"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"}