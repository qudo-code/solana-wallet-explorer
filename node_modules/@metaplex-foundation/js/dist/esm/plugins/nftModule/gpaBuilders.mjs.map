{"version":3,"file":"gpaBuilders.mjs","sources":["../../../../src/plugins/nftModule/gpaBuilders.ts"],"sourcesContent":["import { PublicKey } from '@solana/web3.js';\nimport { Key, PROGRAM_ID } from '@metaplex-foundation/mpl-token-metadata';\nimport { Buffer } from 'buffer';\nimport { Metaplex } from '@/Metaplex';\nimport { GpaBuilder, padEmptyChars } from '@/utils';\nimport { toBigNumber } from '@/types';\n\nconst MAX_NAME_LENGTH = 32;\nconst MAX_SYMBOL_LENGTH = 10;\nconst MAX_URI_LENGTH = 200;\nconst MAX_CREATOR_LEN = 32 + 1 + 1;\nconst DATA_START = 1 + 32 + 32;\nconst NAME_START = DATA_START + 4;\nconst SYMBOL_START = NAME_START + MAX_NAME_LENGTH + 4;\nconst URI_START = SYMBOL_START + MAX_SYMBOL_LENGTH + 4;\nconst CREATORS_START = URI_START + MAX_URI_LENGTH + 2 + 1 + 4;\n\nexport class TokenMetadataGpaBuilder extends GpaBuilder {\n  constructor(metaplex: Metaplex, programId?: PublicKey) {\n    super(metaplex, programId ?? PROGRAM_ID);\n  }\n\n  whereKey(key: Key) {\n    return this.where(0, toBigNumber(key, 'le'));\n  }\n}\n\nexport class MetadataV1GpaBuilder extends TokenMetadataGpaBuilder {\n  constructor(metaplex: Metaplex, programId?: PublicKey) {\n    super(metaplex, programId);\n    this.whereKey(Key.MetadataV1);\n  }\n\n  selectUpdatedAuthority() {\n    return this.slice(1, 32);\n  }\n\n  whereUpdateAuthority(updateAuthority: PublicKey) {\n    return this.where(1, updateAuthority);\n  }\n\n  selectMint() {\n    return this.slice(33, 32);\n  }\n\n  whereMint(mint: PublicKey) {\n    return this.where(33, mint);\n  }\n\n  selectName() {\n    return this.slice(NAME_START, MAX_NAME_LENGTH);\n  }\n\n  whereName(name: string) {\n    return this.where(\n      NAME_START,\n      Buffer.from(padEmptyChars(name, MAX_NAME_LENGTH))\n    );\n  }\n\n  selectSymbol() {\n    return this.slice(SYMBOL_START, MAX_SYMBOL_LENGTH);\n  }\n\n  whereSymbol(symbol: string) {\n    return this.where(\n      SYMBOL_START,\n      Buffer.from(padEmptyChars(symbol, MAX_SYMBOL_LENGTH))\n    );\n  }\n\n  selectUri() {\n    return this.slice(URI_START, MAX_URI_LENGTH);\n  }\n\n  whereUri(uri: string) {\n    return this.where(\n      URI_START,\n      Buffer.from(padEmptyChars(uri, MAX_URI_LENGTH))\n    );\n  }\n\n  selectCreator(position: number) {\n    return this.slice(\n      CREATORS_START + (position - 1) * MAX_CREATOR_LEN,\n      CREATORS_START + position * MAX_CREATOR_LEN\n    );\n  }\n\n  whereCreator(position: number, creator: PublicKey) {\n    return this.where(\n      CREATORS_START + (position - 1) * MAX_CREATOR_LEN,\n      creator\n    );\n  }\n\n  selectFirstCreator() {\n    return this.selectCreator(1);\n  }\n\n  whereFirstCreator(firstCreator: PublicKey) {\n    return this.whereCreator(1, firstCreator);\n  }\n}\n"],"names":["MAX_NAME_LENGTH","MAX_SYMBOL_LENGTH","MAX_URI_LENGTH","MAX_CREATOR_LEN","DATA_START","NAME_START","SYMBOL_START","URI_START","CREATORS_START","TokenMetadataGpaBuilder","GpaBuilder","constructor","metaplex","programId","PROGRAM_ID","whereKey","key","where","toBigNumber","MetadataV1GpaBuilder","Key","MetadataV1","selectUpdatedAuthority","slice","whereUpdateAuthority","updateAuthority","selectMint","whereMint","mint","selectName","whereName","name","Buffer","from","padEmptyChars","selectSymbol","whereSymbol","symbol","selectUri","whereUri","uri","selectCreator","position","whereCreator","creator","selectFirstCreator","whereFirstCreator","firstCreator"],"mappings":"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"}