"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var tt=require("pino"),st=require("@walletconnect/keyvaluestorage"),V=require("@walletconnect/heartbeat"),d=require("@walletconnect/logger"),L=require("@walletconnect/types"),Q=require("@walletconnect/safe-json"),it=require("@walletconnect/relay-auth"),u=require("@walletconnect/utils"),I=require("@walletconnect/time"),rt=require("@walletconnect/jsonrpc-provider"),ee=require("@walletconnect/jsonrpc-utils"),nt=require("@walletconnect/jsonrpc-ws-connection"),at=require("lodash.isequal");function B(s){return s&&typeof s=="object"&&"default"in s?s:{default:s}}function ot(s){if(s&&s.__esModule)return s;var e=Object.create(null);return s&&Object.keys(s).forEach(function(t){if(t!=="default"){var i=Object.getOwnPropertyDescriptor(s,t);Object.defineProperty(e,t,i.get?i:{enumerable:!0,get:function(){return s[t]}})}}),e.default=s,Object.freeze(e)}var te=B(tt),ut=B(st),M=ot(it),ht=B(nt),ct=B(at);function g(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}var K=g;g.EventEmitter=g,g.prototype._events=void 0,g.prototype._maxListeners=void 0,g.defaultMaxListeners=10,g.prototype.setMaxListeners=function(s){if(!lt(s)||s<0||isNaN(s))throw TypeError("n must be a positive number");return this._maxListeners=s,this},g.prototype.emit=function(s){var e,t,i,r,n,a;if(this._events||(this._events={}),s==="error"&&(!this._events.error||N(this._events.error)&&!this._events.error.length)){if(e=arguments[1],e instanceof Error)throw e;var o=new Error('Uncaught, unspecified "error" event. ('+e+")");throw o.context=e,o}if(t=this._events[s],se(t))return!1;if(S(t))switch(arguments.length){case 1:t.call(this);break;case 2:t.call(this,arguments[1]);break;case 3:t.call(this,arguments[1],arguments[2]);break;default:r=Array.prototype.slice.call(arguments,1),t.apply(this,r)}else if(N(t))for(r=Array.prototype.slice.call(arguments,1),a=t.slice(),i=a.length,n=0;n<i;n++)a[n].apply(this,r);return!0},g.prototype.addListener=function(s,e){var t;if(!S(e))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",s,S(e.listener)?e.listener:e),this._events[s]?N(this._events[s])?this._events[s].push(e):this._events[s]=[this._events[s],e]:this._events[s]=e,N(this._events[s])&&!this._events[s].warned&&(se(this._maxListeners)?t=g.defaultMaxListeners:t=this._maxListeners,t&&t>0&&this._events[s].length>t&&(this._events[s].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[s].length),typeof console.trace=="function"&&console.trace())),this},g.prototype.on=g.prototype.addListener,g.prototype.once=function(s,e){if(!S(e))throw TypeError("listener must be a function");var t=!1;function i(){this.removeListener(s,i),t||(t=!0,e.apply(this,arguments))}return i.listener=e,this.on(s,i),this},g.prototype.removeListener=function(s,e){var t,i,r,n;if(!S(e))throw TypeError("listener must be a function");if(!this._events||!this._events[s])return this;if(t=this._events[s],r=t.length,i=-1,t===e||S(t.listener)&&t.listener===e)delete this._events[s],this._events.removeListener&&this.emit("removeListener",s,e);else if(N(t)){for(n=r;n-- >0;)if(t[n]===e||t[n].listener&&t[n].listener===e){i=n;break}if(i<0)return this;t.length===1?(t.length=0,delete this._events[s]):t.splice(i,1),this._events.removeListener&&this.emit("removeListener",s,e)}return this},g.prototype.removeAllListeners=function(s){var e,t;if(!this._events)return this;if(!this._events.removeListener)return arguments.length===0?this._events={}:this._events[s]&&delete this._events[s],this;if(arguments.length===0){for(e in this._events)e!=="removeListener"&&this.removeAllListeners(e);return this.removeAllListeners("removeListener"),this._events={},this}if(t=this._events[s],S(t))this.removeListener(s,t);else if(t)for(;t.length;)this.removeListener(s,t[t.length-1]);return delete this._events[s],this},g.prototype.listeners=function(s){var e;return!this._events||!this._events[s]?e=[]:S(this._events[s])?e=[this._events[s]]:e=this._events[s].slice(),e},g.prototype.listenerCount=function(s){if(this._events){var e=this._events[s];if(S(e))return 1;if(e)return e.length}return 0},g.listenerCount=function(s,e){return s.listenerCount(e)};function S(s){return typeof s=="function"}function lt(s){return typeof s=="number"}function N(s){return typeof s=="object"&&s!==null}function se(s){return s===void 0}function Dt(s,e){if(s.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),i=0;i<t.length;i++)t[i]=255;for(var r=0;r<s.length;r++){var n=s.charAt(r),a=n.charCodeAt(0);if(t[a]!==255)throw new TypeError(n+" is ambiguous");t[a]=r}var o=s.length,h=s.charAt(0),E=Math.log(o)/Math.log(256),l=Math.log(256)/Math.log(o);function D(c){if(c instanceof Uint8Array||(ArrayBuffer.isView(c)?c=new Uint8Array(c.buffer,c.byteOffset,c.byteLength):Array.isArray(c)&&(c=Uint8Array.from(c))),!(c instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(c.length===0)return"";for(var b=0,T=0,f=0,m=c.length;f!==m&&c[f]===0;)f++,b++;for(var w=(m-f)*l+1>>>0,y=new Uint8Array(w);f!==m;){for(var C=c[f],R=0,v=w-1;(C!==0||R<T)&&v!==-1;v--,R++)C+=256*y[v]>>>0,y[v]=C%o>>>0,C=C/o>>>0;if(C!==0)throw new Error("Non-zero carry");T=R,f++}for(var _=w-T;_!==w&&y[_]===0;)_++;for(var F=h.repeat(b);_<w;++_)F+=s.charAt(y[_]);return F}function U(c){if(typeof c!="string")throw new TypeError("Expected String");if(c.length===0)return new Uint8Array;var b=0;if(c[b]!==" "){for(var T=0,f=0;c[b]===h;)T++,b++;for(var m=(c.length-b)*E+1>>>0,w=new Uint8Array(m);c[b];){var y=t[c.charCodeAt(b)];if(y===255)return;for(var C=0,R=m-1;(y!==0||C<f)&&R!==-1;R--,C++)y+=o*w[R]>>>0,w[R]=y%256>>>0,y=y/256>>>0;if(y!==0)throw new Error("Non-zero carry");f=C,b++}if(c[b]!==" "){for(var v=m-f;v!==m&&w[v]===0;)v++;for(var _=new Uint8Array(T+(m-v)),F=T;v!==m;)_[F++]=w[v++];return _}}}function G(c){var b=U(c);if(b)return b;throw new Error(`Non-${e} character`)}return{encode:D,decodeUnsafe:U,decode:G}}var dt=Dt,gt=dt;const ie=s=>{if(s instanceof Uint8Array&&s.constructor.name==="Uint8Array")return s;if(s instanceof ArrayBuffer)return new Uint8Array(s);if(ArrayBuffer.isView(s))return new Uint8Array(s.buffer,s.byteOffset,s.byteLength);throw new Error("Unknown type, must be binary type")},pt=s=>new TextEncoder().encode(s),bt=s=>new TextDecoder().decode(s);class Et{constructor(e,t,i){this.name=e,this.prefix=t,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class yt{constructor(e,t,i){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return re(this,e)}}class ft{constructor(e){this.decoders=e}or(e){return re(this,e)}decode(e){const t=e[0],i=this.decoders[t];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const re=(s,e)=>new ft({...s.decoders||{[s.prefix]:s},...e.decoders||{[e.prefix]:e}});class vt{constructor(e,t,i,r){this.name=e,this.prefix=t,this.baseEncode=i,this.baseDecode=r,this.encoder=new Et(e,t,i),this.decoder=new yt(e,t,r)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const j=({name:s,prefix:e,encode:t,decode:i})=>new vt(s,e,t,i),z=({prefix:s,name:e,alphabet:t})=>{const{encode:i,decode:r}=gt(t,e);return j({prefix:s,name:e,encode:i,decode:n=>ie(r(n))})},mt=(s,e,t,i)=>{const r={};for(let l=0;l<e.length;++l)r[e[l]]=l;let n=s.length;for(;s[n-1]==="=";)--n;const a=new Uint8Array(n*t/8|0);let o=0,h=0,E=0;for(let l=0;l<n;++l){const D=r[s[l]];if(D===void 0)throw new SyntaxError(`Non-${i} character`);h=h<<t|D,o+=t,o>=8&&(o-=8,a[E++]=255&h>>o)}if(o>=t||255&h<<8-o)throw new SyntaxError("Unexpected end of data");return a},wt=(s,e,t)=>{const i=e[e.length-1]==="=",r=(1<<t)-1;let n="",a=0,o=0;for(let h=0;h<s.length;++h)for(o=o<<8|s[h],a+=8;a>t;)a-=t,n+=e[r&o>>a];if(a&&(n+=e[r&o<<t-a]),i)for(;n.length*t&7;)n+="=";return n},p=({name:s,prefix:e,bitsPerChar:t,alphabet:i})=>j({prefix:e,name:s,encode(r){return wt(r,i,t)},decode(r){return mt(r,i,t,s)}}),Ct=j({prefix:"\0",name:"identity",encode:s=>bt(s),decode:s=>pt(s)});var _t=Object.freeze({__proto__:null,identity:Ct});const St=p({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var Rt=Object.freeze({__proto__:null,base2:St});const Ot=p({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var Tt=Object.freeze({__proto__:null,base8:Ot});const It=z({prefix:"9",name:"base10",alphabet:"0123456789"});var At=Object.freeze({__proto__:null,base10:It});const Lt=p({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Pt=p({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var Nt=Object.freeze({__proto__:null,base16:Lt,base16upper:Pt});const zt=p({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),xt=p({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Ut=p({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Ft=p({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Bt=p({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Mt=p({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Kt=p({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),jt=p({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),kt=p({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var $t=Object.freeze({__proto__:null,base32:zt,base32upper:xt,base32pad:Ut,base32padupper:Ft,base32hex:Bt,base32hexupper:Mt,base32hexpad:Kt,base32hexpadupper:jt,base32z:kt});const Yt=z({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Gt=z({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var Vt=Object.freeze({__proto__:null,base36:Yt,base36upper:Gt});const qt=z({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Xt=z({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Ht=Object.freeze({__proto__:null,base58btc:qt,base58flickr:Xt});const Jt=p({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Wt=p({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Zt=p({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Qt=p({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var es=Object.freeze({__proto__:null,base64:Jt,base64pad:Wt,base64url:Zt,base64urlpad:Qt});const ne=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),ts=ne.reduce((s,e,t)=>(s[t]=e,s),[]),ss=ne.reduce((s,e,t)=>(s[e.codePointAt(0)]=t,s),[]);function is(s){return s.reduce((e,t)=>(e+=ts[t],e),"")}function rs(s){const e=[];for(const t of s){const i=ss[t.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(i)}return new Uint8Array(e)}const ns=j({prefix:"\u{1F680}",name:"base256emoji",encode:is,decode:rs});var as=Object.freeze({__proto__:null,base256emoji:ns}),os=oe,ae=128,us=127,hs=~us,cs=Math.pow(2,31);function oe(s,e,t){e=e||[],t=t||0;for(var i=t;s>=cs;)e[t++]=s&255|ae,s/=128;for(;s&hs;)e[t++]=s&255|ae,s>>>=7;return e[t]=s|0,oe.bytes=t-i+1,e}var ls=q,Ds=128,ue=127;function q(s,i){var t=0,i=i||0,r=0,n=i,a,o=s.length;do{if(n>=o)throw q.bytes=0,new RangeError("Could not decode varint");a=s[n++],t+=r<28?(a&ue)<<r:(a&ue)*Math.pow(2,r),r+=7}while(a>=Ds);return q.bytes=n-i,t}var ds=Math.pow(2,7),gs=Math.pow(2,14),ps=Math.pow(2,21),bs=Math.pow(2,28),Es=Math.pow(2,35),ys=Math.pow(2,42),fs=Math.pow(2,49),vs=Math.pow(2,56),ms=Math.pow(2,63),ws=function(s){return s<ds?1:s<gs?2:s<ps?3:s<bs?4:s<Es?5:s<ys?6:s<fs?7:s<vs?8:s<ms?9:10},Cs={encode:os,decode:ls,encodingLength:ws},he=Cs;const ce=(s,e,t=0)=>(he.encode(s,e,t),e),le=s=>he.encodingLength(s),X=(s,e)=>{const t=e.byteLength,i=le(s),r=i+le(t),n=new Uint8Array(r+t);return ce(s,n,0),ce(t,n,i),n.set(e,r),new _s(s,t,e,n)};class _s{constructor(e,t,i,r){this.code=e,this.size=t,this.digest=i,this.bytes=r}}const De=({name:s,code:e,encode:t})=>new Ss(s,e,t);class Ss{constructor(e,t,i){this.name=e,this.code=t,this.encode=i}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?X(this.code,t):t.then(i=>X(this.code,i))}else throw Error("Unknown type, must be binary type")}}const de=s=>async e=>new Uint8Array(await crypto.subtle.digest(s,e)),Rs=De({name:"sha2-256",code:18,encode:de("SHA-256")}),Os=De({name:"sha2-512",code:19,encode:de("SHA-512")});var Ts=Object.freeze({__proto__:null,sha256:Rs,sha512:Os});const ge=0,Is="identity",pe=ie,As=s=>X(ge,pe(s)),Ls={code:ge,name:Is,encode:pe,digest:As};var Ps=Object.freeze({__proto__:null,identity:Ls});new TextEncoder,new TextDecoder;const be={..._t,...Rt,...Tt,...At,...Nt,...$t,...Vt,...Ht,...es,...as};({...Ts,...Ps});function Ns(s=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?globalThis.Buffer.allocUnsafe(s):new Uint8Array(s)}function Ee(s,e,t,i){return{name:s,prefix:e,encoder:{name:s,prefix:e,encode:t},decoder:{decode:i}}}const ye=Ee("utf8","u",s=>{const e=new TextDecoder("utf8");return"u"+e.decode(s)},s=>new TextEncoder().encode(s.substring(1))),H=Ee("ascii","a",s=>{let e="a";for(let t=0;t<s.length;t++)e+=String.fromCharCode(s[t]);return e},s=>{s=s.substring(1);const e=Ns(s.length);for(let t=0;t<s.length;t++)e[t]=s.charCodeAt(t);return e}),zs={utf8:ye,"utf-8":ye,hex:be.base16,latin1:H,ascii:H,binary:H,...be};function xs(s,e="utf8"){const t=zs[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(s,"utf8"):t.decoder.decode(`${t.prefix}${s}`)}const J="wc",fe=2,k="core",P=`${J}@${2}:${k}:`,ve={name:k,logger:"error"},me={database:":memory:"},we="crypto",W="client_ed25519_seed",Ce=I.ONE_DAY,_e="keychain",Se="0.3",Re="messages",Oe="0.3",Te=I.SIX_HOURS,Ie="publisher",Us="irn",Ae="error",Le="wss://relay.walletconnect.com",Pe="relayer",x={message:"relayer_message",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error"},Ne="_subscription",A={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},ze=I.ONE_SECOND,Fs={database:":memory:"},xe="2.0.0-rc.1",Ue="0.3",O={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync"},Bs=I.THIRTY_DAYS,Fe="subscription",Be="0.3",Me=I.FIVE_SECONDS*1e3;class Ke{constructor(e,t){this.core=e,this.logger=t,this.keychain=new Map,this.name=_e,this.version=Se,this.initialized=!1,this.storagePrefix=P,this.init=async()=>{if(!this.initialized){const i=await this.getKeyChain();typeof i<"u"&&(this.keychain=i),this.initialized=!0}},this.has=i=>(this.isInitialized(),this.keychain.has(i)),this.set=async(i,r)=>{this.isInitialized(),this.keychain.set(i,r),await this.persist()},this.get=i=>{this.isInitialized();const r=this.keychain.get(i);if(typeof r>"u"){const{message:n}=u.getInternalError("NO_MATCHING_KEY",`${this.name}: ${i}`);throw new Error(n)}return r},this.del=async i=>{this.isInitialized(),this.keychain.delete(i),await this.persist()},this.core=e,this.logger=d.generateChildLogger(t,this.name)}get context(){return d.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,u.mapToObj(e))}async getKeyChain(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?u.objToMap(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:e}=u.getInternalError("NOT_INITIALIZED",this.name);throw new Error(e)}}}class je{constructor(e,t,i){this.core=e,this.logger=t,this.name=we,this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=r=>(this.isInitialized(),this.keychain.has(r)),this.getClientId=async()=>{this.isInitialized();const r=await this.getClientSeed(),n=M.generateKeyPair(r);return M.encodeIss(n.publicKey)},this.generateKeyPair=()=>{this.isInitialized();const r=u.generateKeyPair();return this.setPrivateKey(r.publicKey,r.privateKey)},this.signJWT=async r=>{this.isInitialized();const n=await this.getClientSeed(),a=M.generateKeyPair(n),o=u.generateRandomBytes32(),h=Ce;return await M.signJWT(o,r,h,a)},this.generateSharedKey=(r,n,a)=>{this.isInitialized();const o=this.getPrivateKey(r),h=u.deriveSymKey(o,n);return this.setSymKey(h,a)},this.setSymKey=async(r,n)=>{this.isInitialized();const a=n||u.hashKey(r);return await this.keychain.set(a,r),a},this.deleteKeyPair=async r=>{this.isInitialized(),await this.keychain.del(r)},this.deleteSymKey=async r=>{this.isInitialized(),await this.keychain.del(r)},this.encode=async(r,n,a)=>{this.isInitialized();const o=u.validateEncoding(a),h=Q.safeJsonStringify(n);if(u.isTypeOneEnvelope(o)){const U=o.senderPublicKey,G=o.receiverPublicKey;r=await this.generateSharedKey(U,G)}const E=this.getSymKey(r),{type:l,senderPublicKey:D}=o;return u.encrypt({type:l,symKey:E,message:h,senderPublicKey:D})},this.decode=async(r,n,a)=>{this.isInitialized();const o=u.validateDecoding(n,a);if(u.isTypeOneEnvelope(o)){const l=o.receiverPublicKey,D=o.senderPublicKey;r=await this.generateSharedKey(l,D)}const h=this.getSymKey(r),E=u.decrypt({symKey:h,encoded:n});return Q.safeJsonParse(E)},this.core=e,this.logger=d.generateChildLogger(t,this.name),this.keychain=i||new Ke(this.core,this.logger)}get context(){return d.getLoggerContext(this.logger)}async setPrivateKey(e,t){return await this.keychain.set(e,t),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get(W)}catch{e=u.generateRandomBytes32(),await this.keychain.set(W,e)}return xs(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){const{message:e}=u.getInternalError("NOT_INITIALIZED",this.name);throw new Error(e)}}}class ke extends L.IMessageTracker{constructor(e,t){super(e,t),this.logger=e,this.core=t,this.messages=new Map,this.name=Re,this.version=Oe,this.initialized=!1,this.storagePrefix=P,this.init=async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const i=await this.getRelayerMessages();typeof i<"u"&&(this.messages=i),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(i){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(i)}finally{this.initialized=!0}}},this.set=async(i,r)=>{this.isInitialized();const n=u.hashMessage(r);let a=this.messages.get(i);return typeof a>"u"&&(a={}),typeof a[n]<"u"||(a[n]=r,this.messages.set(i,a),await this.persist()),n},this.get=i=>{this.isInitialized();let r=this.messages.get(i);return typeof r>"u"&&(r={}),r},this.has=(i,r)=>{this.isInitialized();const n=this.get(i),a=u.hashMessage(r);return typeof n[a]<"u"},this.del=async i=>{this.isInitialized(),this.messages.delete(i),await this.persist()},this.logger=d.generateChildLogger(e,this.name),this.core=t}get context(){return d.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,u.mapToObj(e))}async getRelayerMessages(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?u.objToMap(e):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:e}=u.getInternalError("NOT_INITIALIZED",this.name);throw new Error(e)}}}class Ms extends L.IPublisher{constructor(e,t){super(e,t),this.relayer=e,this.logger=t,this.events=new K.EventEmitter,this.name=Ie,this.queue=new Map,this.publish=async(i,r,n)=>{this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:i,message:r,opts:n}});try{const a=n?.ttl||Te,o=u.getRelayProtocolName(n),h=n?.prompt||!1,E=n?.tag||0,l={topic:i,message:r,opts:{ttl:a,relay:o,prompt:h,tag:E}},D=u.hashMessage(r);this.queue.set(D,l),await this.rpcPublish(i,r,a,o,h,E),this.onPublish(D,l),this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:i,message:r,opts:n}})}catch(a){throw this.logger.debug("Failed to Publish Payload"),this.logger.error(a),a}},this.on=(i,r)=>{this.events.on(i,r)},this.once=(i,r)=>{this.events.once(i,r)},this.off=(i,r)=>{this.events.off(i,r)},this.removeListener=(i,r)=>{this.events.removeListener(i,r)},this.relayer=e,this.logger=d.generateChildLogger(t,this.name),this.registerEventListeners()}get context(){return d.getLoggerContext(this.logger)}rpcPublish(e,t,i,r,n,a){var o,h,E,l;const D={method:u.getRelayProtocolApi(r.protocol).publish,params:{topic:e,message:t,ttl:i,prompt:n,tag:a}};return u.isUndefined((o=D.params)==null?void 0:o.prompt)&&((h=D.params)==null||delete h.prompt),u.isUndefined((E=D.params)==null?void 0:E.tag)&&((l=D.params)==null||delete l.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:D}),this.relayer.provider.request(D)}onPublish(e,t){this.queue.delete(e)}checkQueue(){this.queue.forEach(async e=>{const{topic:t,message:i,opts:{ttl:r,relay:n,prompt:a,tag:o}}=e,h=u.hashMessage(i);await this.rpcPublish(t,i,r,n,a,o),this.onPublish(h,e)})}registerEventListeners(){this.relayer.core.heartbeat.on(V.HEARTBEAT_EVENTS.pulse,()=>{this.checkQueue()})}}class Ks{constructor(){this.map=new Map,this.set=(e,t)=>{const i=this.get(e);this.exists(e,t)||this.map.set(e,[...i,t])},this.get=e=>this.map.get(e)||[],this.exists=(e,t)=>this.get(e).includes(t),this.delete=(e,t)=>{if(typeof t>"u"){this.map.delete(e);return}if(!this.map.has(e))return;const i=this.get(e);if(!this.exists(e,t))return;const r=i.filter(n=>n!==t);if(!r.length){this.map.delete(e);return}this.map.set(e,r)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}}var js=Object.defineProperty,ks=Object.defineProperties,$s=Object.getOwnPropertyDescriptors,$e=Object.getOwnPropertySymbols,Ys=Object.prototype.hasOwnProperty,Gs=Object.prototype.propertyIsEnumerable,Ye=(s,e,t)=>e in s?js(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,$=(s,e)=>{for(var t in e||(e={}))Ys.call(e,t)&&Ye(s,t,e[t]);if($e)for(var t of $e(e))Gs.call(e,t)&&Ye(s,t,e[t]);return s},Z=(s,e)=>ks(s,$s(e));class Ge extends L.ISubscriber{constructor(e,t){super(e,t),this.relayer=e,this.logger=t,this.subscriptions=new Map,this.topicMap=new Ks,this.events=new K.EventEmitter,this.name=Fe,this.version=Be,this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel="pending_sub_watch_label",this.pendingSubInterval=20,this.storagePrefix=P,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),await this.reset(),this.registerEventListeners(),this.onEnable())},this.subscribe=async(i,r)=>{this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:i,opts:r}});try{const n=u.getRelayProtocolName(r),a={topic:i,relay:n};this.pending.set(i,a);const o=await this.rpcSubscribe(i,n);return this.onSubscribe(o,a),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:i,opts:r}}),o}catch(n){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(n),n}},this.unsubscribe=async(i,r)=>{this.isInitialized(),typeof r?.id<"u"?await this.unsubscribeById(i,r.id,r):await this.unsubscribeByTopic(i,r)},this.isSubscribed=async i=>this.topics.includes(i)?!0:await new Promise((r,n)=>{const a=new I.Watch;a.start(this.pendingSubscriptionWatchLabel);const o=setInterval(()=>{!this.pending.has(i)&&this.topics.includes(i)&&(clearInterval(o),a.stop(this.pendingSubscriptionWatchLabel),r(!0)),a.elapsed(this.pendingSubscriptionWatchLabel)>=Me&&(clearInterval(o),a.stop(this.pendingSubscriptionWatchLabel),n(!1))},this.pendingSubInterval)}),this.on=(i,r)=>{this.events.on(i,r)},this.once=(i,r)=>{this.events.once(i,r)},this.off=(i,r)=>{this.events.off(i,r)},this.removeListener=(i,r)=>{this.events.removeListener(i,r)},this.relayer=e,this.logger=d.generateChildLogger(t,this.name)}get context(){return d.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(e,t){let i=!1;try{i=this.getSubscription(e).topic===t}catch{}return i}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear(),this.initialized=!1}async unsubscribeByTopic(e,t){const i=this.topicMap.get(e);await Promise.all(i.map(async r=>await this.unsubscribeById(e,r,t)))}async unsubscribeById(e,t,i){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:t,opts:i}});try{const r=u.getRelayProtocolName(i);await this.rpcUnsubscribe(e,t,r);const n=u.getSdkError("USER_DISCONNECTED",`${this.name}, ${e}`);await this.onUnsubscribe(e,t,n),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:t,opts:i}})}catch(r){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(r),r}}async rpcSubscribe(e,t){const i={method:u.getRelayProtocolApi(t.protocol).subscribe,params:{topic:e}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i}),await this.relayer.provider.request(i)}rpcUnsubscribe(e,t,i){const r={method:u.getRelayProtocolApi(i.protocol).unsubscribe,params:{topic:e,id:t}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:r}),this.relayer.provider.request(r)}onSubscribe(e,t){this.setSubscription(e,Z($({},t),{id:e})),this.pending.delete(t.topic)}onResubscribe(e,t){this.addSubscription(e,Z($({},t),{id:e})),this.pending.delete(t.topic)}async onUnsubscribe(e,t,i){this.events.removeAllListeners(t),this.hasSubscription(t,e)&&this.deleteSubscription(t,i),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,t){this.subscriptions.has(e)||(this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:t}),this.addSubscription(e,t))}addSubscription(e,t){this.subscriptions.set(e,$({},t)),this.topicMap.set(t.topic,e),this.events.emit(O.created,t)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});const t=this.subscriptions.get(e);if(!t){const{message:i}=u.getInternalError("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(i)}return t}deleteSubscription(e,t){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:t});const i=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(i.topic,e),this.events.emit(O.deleted,Z($({},i),{reason:t}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(O.sync)}async reset(){!this.cached.length||await Promise.all(this.cached.map(async e=>await this.resubscribe(e)))}async restore(){try{const e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size){const{message:t}=u.getInternalError("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async resubscribe(e){if(!this.ids.includes(e.id)){const{topic:t,relay:i}=e,r={topic:t,relay:i};this.pending.set(r.topic,r);const n=await this.rpcSubscribe(r.topic,r.relay);this.onResubscribe(n,r)}}async onConnect(){await this.reset(),this.onEnable()}onDisconnect(){this.onDisable()}checkPending(){this.pending.forEach(async e=>{const t=await this.rpcSubscribe(e.topic,e.relay);this.onSubscribe(t,e)})}registerEventListeners(){this.relayer.core.heartbeat.on(V.HEARTBEAT_EVENTS.pulse,()=>{this.checkPending()}),this.relayer.provider.on(A.connect,async()=>{await this.onConnect()}),this.relayer.provider.on(A.disconnect,()=>{this.onDisconnect()}),this.events.on(O.created,async e=>{const t=O.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),await this.persist()}),this.events.on(O.deleted,async e=>{const t=O.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),await this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=u.getInternalError("NOT_INITIALIZED",this.name);throw new Error(e)}}}var Vs=Object.defineProperty,Ve=Object.getOwnPropertySymbols,qs=Object.prototype.hasOwnProperty,Xs=Object.prototype.propertyIsEnumerable,qe=(s,e,t)=>e in s?Vs(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,Hs=(s,e)=>{for(var t in e||(e={}))qs.call(e,t)&&qe(s,t,e[t]);if(Ve)for(var t of Ve(e))Xs.call(e,t)&&qe(s,t,e[t]);return s};class Xe extends L.IRelayer{constructor(e){super(e),this.protocol="wc",this.version=2,this.events=new K.EventEmitter,this.name=Pe,this.initialized=!1,this.core=e.core,this.logger=typeof e.logger<"u"&&typeof e.logger!="string"?d.generateChildLogger(e.logger,this.name):te.default(d.getDefaultLoggerOptions({level:e.logger||Ae})),this.messages=new ke(this.logger,e.core),this.subscriber=new Ge(this,this.logger),this.publisher=new Ms(this,this.logger),this.relayUrl=e?.relayUrl||Le,this.projectId=e.projectId,this.provider={}}async init(){this.logger.trace("Initialized");const e=await this.core.crypto.signJWT(this.relayUrl);this.provider=this.createProvider(e),await Promise.all([this.messages.init(),this.provider.connect(),this.subscriber.init()]),this.registerEventListeners(),this.initialized=!0}get context(){return d.getLoggerContext(this.logger)}get connected(){return this.provider.connection.connected}get connecting(){return this.provider.connection.connecting}async publish(e,t,i){this.isInitialized(),await this.publisher.publish(e,t,i),await this.recordMessageEvent({topic:e,message:t})}async subscribe(e,t){return this.isInitialized(),await this.subscriber.subscribe(e,t)}async unsubscribe(e,t){this.isInitialized(),await this.subscriber.unsubscribe(e,t)}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}createProvider(e){return new rt.JsonRpcProvider(new ht.default(u.formatRelayRpcUrl({sdkVersion:xe,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e})))}async recordMessageEvent(e){const{topic:t,message:i}=e;await this.messages.set(t,i)}async shouldIgnoreMessageEvent(e){const{topic:t,message:i}=e;return await this.subscriber.isSubscribed(t)?this.messages.has(t,i):!0}async onProviderPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),ee.isJsonRpcRequest(e)){if(!e.method.endsWith(Ne))return;const t=e.params,{topic:i,message:r}=t.data,n={topic:i,message:r};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(Hs({type:"event",event:t.id},n)),this.events.emit(t.id,n),await this.acknowledgePayload(e),await this.onMessageEvent(n)}}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(this.events.emit(x.message,e),await this.recordMessageEvent(e))}async acknowledgePayload(e){const t=ee.formatJsonRpcResult(e.id,!0);await this.provider.connection.send(t)}registerEventListeners(){this.provider.on(A.payload,e=>this.onProviderPayload(e)),this.provider.on(A.connect,()=>{this.events.emit(x.connect)}),this.provider.on(A.disconnect,()=>{this.events.emit(x.disconnect),setTimeout(()=>{this.provider.connect()},I.toMiliseconds(ze))}),this.provider.on(A.error,e=>this.events.emit(x.error,e))}isInitialized(){if(!this.initialized){const{message:e}=u.getInternalError("NOT_INITIALIZED",this.name);throw new Error(e)}}}var Js=Object.defineProperty,He=Object.getOwnPropertySymbols,Ws=Object.prototype.hasOwnProperty,Zs=Object.prototype.propertyIsEnumerable,Je=(s,e,t)=>e in s?Js(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,We=(s,e)=>{for(var t in e||(e={}))Ws.call(e,t)&&Je(s,t,e[t]);if(He)for(var t of He(e))Zs.call(e,t)&&Je(s,t,e[t]);return s};class Qs extends L.IStore{constructor(e,t,i,r=P,n=void 0){super(e,t,i,r),this.core=e,this.logger=t,this.name=i,this.map=new Map,this.version=Ue,this.cached=[],this.initialized=!1,this.storagePrefix=P,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(a=>{u.isProposalStruct(a)?this.map.set(a.id,a):u.isSessionStruct(a)?this.map.set(a.topic,a):this.getKey&&a!==null&&!u.isUndefined(a)&&this.map.set(this.getKey(a),a)}),this.cached=[],this.initialized=!0)},this.set=async(a,o)=>{this.isInitialized(),this.map.has(a)?await this.update(a,o):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:a,value:o}),this.map.set(a,o),await this.persist())},this.get=a=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:a}),this.getData(a)),this.getAll=a=>a?this.values.filter(o=>Object.keys(a).every(h=>ct.default(o[h],a[h]))):this.values,this.update=async(a,o)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:a,update:o});const h=We(We({},this.getData(a)),o);this.map.set(a,h),await this.persist()},this.delete=async(a,o)=>{this.isInitialized(),this.map.has(a)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:a,reason:o}),this.map.delete(a),await this.persist())},this.logger=d.generateChildLogger(t,this.name),this.storagePrefix=r,this.getKey=n}get context(){return d.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){const t=this.map.get(e);if(!t){const{message:i}=u.getInternalError("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(i),new Error(i)}return t}async persist(){await this.setDataStore(this.values)}async restore(){try{const e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){const{message:t}=u.getInternalError("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){const{message:e}=u.getInternalError("NOT_INITIALIZED",this.name);throw new Error(e)}}}var ei=Object.defineProperty,Ze=Object.getOwnPropertySymbols,ti=Object.prototype.hasOwnProperty,si=Object.prototype.propertyIsEnumerable,Qe=(s,e,t)=>e in s?ei(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,et=(s,e)=>{for(var t in e||(e={}))ti.call(e,t)&&Qe(s,t,e[t]);if(Ze)for(var t of Ze(e))si.call(e,t)&&Qe(s,t,e[t]);return s};class Y extends L.ICore{constructor(e){super(e),this.protocol=J,this.version=fe,this.name=k,this.events=new K.EventEmitter,this.initialized=!1,this.on=(i,r)=>this.events.on(i,r),this.once=(i,r)=>this.events.once(i,r),this.off=(i,r)=>this.events.off(i,r),this.removeListener=(i,r)=>this.events.removeListener(i,r),this.projectId=e?.projectId;const t=typeof e?.logger<"u"&&typeof e?.logger!="string"?e.logger:te.default(d.getDefaultLoggerOptions({level:e?.logger||ve.logger}));this.logger=d.generateChildLogger(t,this.name),this.heartbeat=new V.HeartBeat,this.crypto=new je(this,this.logger,e?.keychain),this.storage=e!=null&&e.storage?e.storage:new ut.default(et(et({},me),e?.storageOptions)),this.relayer=new Xe({core:this,logger:this.logger,relayUrl:e?.relayUrl,projectId:this.projectId})}static async init(e){const t=new Y(e);return await t.initialize(),t}get context(){return d.getLoggerContext(this.logger)}async start(){this.initialized||await this.initialize()}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.relayer.init(),await this.heartbeat.init(),this.initialized=!0,this.logger.info("Core Initilization Success")}catch(e){throw this.logger.info("Core Initilization Failure"),this.logger.error(e.message),e}}}const ii=Y;exports.CORE_CONTEXT=k,exports.CORE_DEFAULT=ve,exports.CORE_PROTOCOL=J,exports.CORE_STORAGE_OPTIONS=me,exports.CORE_STORAGE_PREFIX=P,exports.CORE_VERSION=fe,exports.CRYPTO_CLIENT_SEED=W,exports.CRYPTO_CONTEXT=we,exports.CRYPTO_JWT_TTL=Ce,exports.Core=ii,exports.Crypto=je,exports.KEYCHAIN_CONTEXT=_e,exports.KEYCHAIN_STORAGE_VERSION=Se,exports.KeyChain=Ke,exports.MESSAGES_CONTEXT=Re,exports.MESSAGES_STORAGE_VERSION=Oe,exports.MessageTracker=ke,exports.PENDING_SUB_RESOLUTION_TIMEOUT=Me,exports.PUBLISHER_CONTEXT=Ie,exports.PUBLISHER_DEFAULT_TTL=Te,exports.RELAYER_CONTEXT=Pe,exports.RELAYER_DEFAULT_LOGGER=Ae,exports.RELAYER_DEFAULT_PROTOCOL=Us,exports.RELAYER_DEFAULT_RELAY_URL=Le,exports.RELAYER_EVENTS=x,exports.RELAYER_PROVIDER_EVENTS=A,exports.RELAYER_RECONNECT_TIMEOUT=ze,exports.RELAYER_SDK_VERSION=xe,exports.RELAYER_STORAGE_OPTIONS=Fs,exports.RELAYER_SUBSCRIBER_SUFFIX=Ne,exports.Relayer=Xe,exports.STORE_STORAGE_VERSION=Ue,exports.SUBSCRIBER_CONTEXT=Fe,exports.SUBSCRIBER_DEFAULT_TTL=Bs,exports.SUBSCRIBER_EVENTS=O,exports.SUBSCRIBER_STORAGE_VERSION=Be,exports.Store=Qs,exports.Subscriber=Ge,exports.default=Y;
//# sourceMappingURL=index.cjs.js.map
